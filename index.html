<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>æ•…å®«å¯»å®ï¼šç¥å…½å¤§ä½œæˆ˜</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'SimHei', sans-serif;
            background: linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            border-bottom: 5px solid #FFD700;
        }

        main {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        h1,
        h2 {
            color: #8B0000;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        p {
            line-height: 1.8;
            margin-bottom: 10px;
            font-size: 1em;
        }

        /* é¦–é¡µæ ·å¼ */
        #home-page {
            text-align: center;
        }

        .story-intro {
            margin-top: 20px;
            padding: 20px;
            border: 3px solid #FFD700;
            border-radius: 15px;
            background: linear-gradient(135deg, #FFFACD 0%, #FFFFE0 100%);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .story-intro p {
            font-size: 1.05em;
            text-align: left;
        }

        .start-button {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700 0%, #FFC700 100%);
            color: #8B0000;
            padding: 18px 35px;
            margin-top: 30px;
            margin-bottom: 20px;
            border-radius: 50px;
            font-size: 1.3em;
            font-weight: bold;
            text-decoration: none;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            border: 2px solid #8B0000;
            cursor: pointer;
        }

        .start-button:active {
            transform: scale(0.95);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        .start-button:hover {
            background: linear-gradient(135deg, #FFC700 0%, #FFB700 100%);
        }

        /* åˆ—è¡¨é¡µæ ·å¼ */
        .progress-bar {
            width: 100%;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3CB371 0%, #2E8B57 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .checkpoint-list {
            list-style: none;
            padding: 0;
        }

        .checkpoint-item {
            background: linear-gradient(135deg, #FDF5E6 0%, #FFFACD 100%);
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid #8B0000;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .checkpoint-item:active {
            transform: translateX(5px);
        }

        .checkpoint-item.completed {
            border-left: 5px solid #3CB371;
            background: linear-gradient(135deg, #F0FFF0 0%, #E0FFE0 100%);
        }

        .item-info h3 {
            margin: 0 0 5px 0;
            color: #8B0000;
            font-size: 1.1em;
        }

        .item-info p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }

        .item-status {
            font-weight: bold;
            color: #8B0000;
            font-size: 0.95em;
            padding: 5px 10px;
            background-color: #FFE4B5;
            border-radius: 20px;
        }

        .checkpoint-item.completed .item-status {
            color: white;
            background-color: #3CB371;
        }

        /* è¯¦æƒ…é¡µæ ·å¼ */
        .detail-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .detail-knowledge {
            background-color: #F5F5F5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            line-height: 1.8;
            font-size: 1em;
        }

        .pose-box {
            background: linear-gradient(135deg, #FFFACD 0%, #FFFFE0 100%);
            border: 2px dashed #FFD700;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .pose-box h4 {
            color: #8B0000;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .pose-text {
            font-size: 1.05em;
            line-height: 1.6;
            color: #333;
        }

        .action-button {
            display: block;
            width: 100%;
            padding: 16px;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .check-in-button {
            background: linear-gradient(135deg, #3CB371 0%, #2E8B57 100%);
            color: white;
        }

        .check-in-button:active {
            transform: scale(0.98);
        }

        .check-in-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .back-button {
            background-color: #ddd;
            color: #333;
        }

        .back-button:active {
            background-color: #bbb;
        }

        .badge-info {
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            border: 2px solid #FFD700;
            border-radius: 10px;
            background-color: #FFFACD;
        }

        .badge-info img {
            width: 100px;
            height: 100px;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .badge-info p {
            margin: 0;
            font-weight: bold;
            color: #8B0000;
        }

        /* ç»ˆæå¥–åŠ±é¡µæ ·å¼ */
        #reward-page {
            text-align: center;
        }

        .trophy {
            font-size: 6em;
            margin: 20px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .certificate {
            border: 5px double #8B0000;
            padding: 25px;
            margin-top: 20px;
            background: linear-gradient(135deg, #FDF5E6 0%, #FFFACD 100%);
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .certificate h2 {
            font-size: 1.6em;
            margin-bottom: 15px;
            color: #8B0000;
        }

        .certificate p {
            font-size: 1.05em;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .seal-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* éšè—é¡µé¢ */
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            header {
                font-size: 1.5em;
                padding: 20px 15px;
            }

            h1,
            h2 {
                font-size: 1.3em;
            }

            .start-button {
                font-size: 1.1em;
                padding: 15px 30px;
            }

            .action-button {
                font-size: 1em;
                padding: 14px;
            }
        }
        /* Toast æç¤º */
        .toast {
            position: fixed;
            left: 50%;
            bottom: 24px;
            transform: translateX(-50%);
            background: rgba(60, 179, 113, 0.95);
            color: #fff;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            font-weight: bold;
            z-index: 9999;
            display: none;
            max-width: 90%;
            text-align: center;
        }
        /* åœ°å›¾æ ‡è®°é¢œè‰²ï¼ˆè‡ªå®šä¹‰ DivIcon å°åœ†ç‚¹ï¼‰ */
        .cp-pin {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.15), 0 2px 6px rgba(0,0,0,0.2);
        }
        .cp-pin.pending { background: #DC143C; }
        .cp-pin.completed { background: #2E8B57; }
    </style>
    <!-- Leaflet åœ°å›¾æ ·å¼ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>
<script>
    // å°†æ‰€æœ‰å‡½æ•°å®šä¹‰æ”¾åœ¨å…¨å±€ä½œç”¨åŸŸï¼Œç¡®ä¿onclickäº‹ä»¶å¯ä»¥è®¿é—®
    // æ•…å®«æ‰“å¡ç‚¹æ•°æ®
    const checkpoints = [
        {
            id: 1,
            name: "å¤ªå’Œæ®¿ (é‡‘éŠ®æ®¿)",
            badgeName: "é¾™",
            badgeImg: "badge_dragon.png",
            knowledge: "æ•…å®«æœ€å¤§çš„å®«æ®¿ï¼Œæ˜¯çš‡å¸ä¸¾è¡Œæœ€é‡è¦ä»ªå¼çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç™»åŸºã€ç»“å©šã€‚å±‹é¡¶ä¸Šæœ‰10ä¸ªç¥å…½ï¼Œä»£è¡¨æœ€é«˜ç­‰çº§ï¼",
            pose: '"æˆ‘æ˜¯çš‡å¸"ï¼šåŒæ‰‹å‰è…°ï¼ŒæŠ¬å¤´æŒºèƒ¸ï¼Œåšå‡ºå¨é£å‡›å‡›çš„æ ·å­ã€‚',
            image: "tahe.jpg",
            lat: 39.916345,
            lng: 116.397155,
            completed: false
        },
        {
            id: 2,
            name: "ä¹¾æ¸…å®« (çš‡å¸å¯å®«)",
            badgeName: "å‡¤",
            badgeImg: "badge_phoenix.png",
            knowledge: 'çš‡å¸ä½çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å¤„ç†æ—¥å¸¸æ”¿åŠ¡çš„åœ°æ–¹ã€‚æ®¿å†…æŒ‚ç€"æ­£å¤§å…‰æ˜"çš„ç‰ŒåŒ¾ï¼Œæ˜¯æ¸…æœçš‡å¸é€‰ç»§æ‰¿äººçš„ç§˜å¯†ã€‚',
            pose: '"æ­£å¤§å…‰æ˜"ï¼šä¸€åªæ‰‹æŒ‡å‘"æ­£å¤§å…‰æ˜"ç‰ŒåŒ¾ï¼Œå¦ä¸€åªæ‰‹ç«–èµ·å¤§æ‹‡æŒ‡ã€‚',
            image: "qianqing.jpg",
            lat: 39.91741,
            lng: 116.39727,
            completed: false
        },
        {
            id: 3,
            name: "å¾¡èŠ±å›­ (çš‡å®¶èŠ±å›­)",
            badgeName: "ç‹®",
            badgeImg: "badge_lion.png",
            knowledge: "çš‡å¸å’Œå®¶äººä»¬æ•£æ­¥ã€ç©è€çš„èŠ±å›­ã€‚é‡Œé¢æœ‰å¾ˆå¤šå¥‡å½¢æ€ªçŠ¶çš„çŸ³å¤´å’Œå¤è€çš„æ ‘æœ¨ï¼Œåƒä¸€ä¸ªè¿·å®«ã€‚",
            pose: '"ç¥å…½å®ˆå«"ï¼šæ¨¡ä»¿å¾¡èŠ±å›­é‡Œçš„çŸ³ç‹®å­ï¼Œåšå‡ºå¨æ­¦çš„è¹²åå§¿åŠ¿ã€‚',
            image: "yuhuayuan.jpg",
            lat: 39.91822,
            lng: 116.39722,
            completed: false
        },
        {
            id: 4,
            name: "ä¹é¾™å£ (å½©è‰²å·¨é¾™)",
            badgeName: "æµ·é©¬",
            badgeImg: "badge_seahorse.png",
            knowledge: "ä¸€é¢å·¨å¤§çš„å½©è‰²å¢™å£ï¼Œä¸Šé¢æœ‰ä¹æ¡æ´»çµæ´»ç°çš„é¾™ã€‚å®ƒä»¬ä»£è¡¨ç€çš‡å¸çš„è‡³é«˜æ— ä¸Šã€‚æ•°ä¸€æ•°ï¼Œæ˜¯ä¸æ˜¯çœŸçš„æœ‰ä¹æ¡é¾™ï¼Ÿ",
            pose: '"é£é¾™åœ¨å¤©"ï¼šåŒè‡‚å¼ å¼€ï¼Œåƒé¾™ä¸€æ ·åœ¨ç©ºä¸­é£ç¿”ã€‚',
            image: "jiulongbi.jpg",
            lat: 39.91943,
            lng: 116.39705,
            completed: false
        },
        {
            id: 5,
            name: "è§’æ¥¼ (æ•…å®«çš„çœ¼ç›)",
            badgeName: "æ–—ç‰›",
            badgeImg: "badge_bull.png",
            knowledge: "æ•…å®«åŸå¢™çš„å››ä¸ªè§’ä¸Šéƒ½æœ‰ä¸€ä¸ªæ¼‚äº®çš„è§’æ¥¼ï¼Œåƒä¸€åº§å°å°çš„ä»™å®«ã€‚ä¼ è¯´å®ƒæœ‰ä¹æ¢åå…«æŸ±ä¸ƒåäºŒæ¡è„Šã€‚",
            pose: '"ç­æœ›è¿œæ–¹"ï¼šä¸€åªæ‰‹æ­åœ¨é¢å¤´ä¸Šï¼Œåšå‡ºå‘è¿œæ–¹çœºæœ›çš„å§¿åŠ¿ã€‚',
            image: "jiaolou.jpg",
            lat: 39.92303,
            lng: 116.40252,
            completed: false
        }
    ];

    let currentCheckpointId = null;

    // åœ°å›¾å®ä¾‹ï¼ˆæ‡’åŠ è½½ï¼‰
    let mapInstance = null;
    let markerLayer = null;
    let userLocationLayer = null;
    let pendingIcon = null;
    let completedIcon = null;

    // é¡µé¢åˆ‡æ¢å‡½æ•°
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');

        if (pageId === 'list-page') {
            renderCheckpointMap();
        }
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
        const completedCount = checkpoints.filter(cp => cp.completed).length;
        const percentage = (completedCount / checkpoints.length) * 100;
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');

        progressFill.style.width = percentage + '%';
        progressText.textContent = completedCount + '/5';
    }

    // æ¸²æŸ“æ‰“å¡ç‚¹åœ°å›¾
    function renderCheckpointMap() {
        // æ›´æ–°è¿›åº¦æ¡ä¸å¥–åŠ±æç¤º
        let completedCount = checkpoints.filter(cp => cp.completed).length;
        updateProgress();
        const rewardPrompt = document.getElementById('reward-prompt');
        rewardPrompt.style.display = completedCount === checkpoints.length ? 'block' : 'none';

        // é¦–æ¬¡åˆ›å»ºåœ°å›¾
        if (!mapInstance) {
            const defaultCenter = [39.9173, 116.3972]; // æ•…å®«ä¸­è½´è¿‘ä¼¼
            mapInstance = L.map('map', {
                center: defaultCenter,
                zoom: 16,
                scrollWheelZoom: false
            });
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(mapInstance);
            markerLayer = L.layerGroup().addTo(mapInstance);

            // å®šä¹‰ä¸¤ç§çŠ¶æ€çš„æ ‡è®°æ ·å¼
            pendingIcon = L.divIcon({
                className: '',
                html: '<div class="cp-pin pending"></div>',
                iconSize: [18, 18],
                iconAnchor: [9, 9]
            });
            completedIcon = L.divIcon({
                className: '',
                html: '<div class="cp-pin completed"></div>',
                iconSize: [18, 18],
                iconAnchor: [9, 9]
            });
        }

        // æ¸…ç©ºå¹¶é‡æ–°ç»˜åˆ¶æ ‡è®°
        markerLayer.clearLayers();
        const bounds = [];
        checkpoints.forEach(cp => {
            if (typeof cp.lat !== 'number' || typeof cp.lng !== 'number') return;
            const marker = L.marker([cp.lat, cp.lng], {
                title: cp.name,
                icon: cp.completed ? completedIcon : pendingIcon
            });
            const statusText = cp.completed ? `âœ“ å·²è·å¾— ${cp.badgeName} å¾½ç« ` : 'â–¶ å»æ‰“å¡';
            const popupHtml = `
                <div style="min-width:200px">
                    <img src="${cp.image}" alt="ç¼©ç•¥å›¾" style="width:100%;height:90px;object-fit:cover;border-radius:8px;margin-bottom:6px;" />
                    <div style=\"font-weight:bold;color:#8B0000;margin-bottom:6px;\">${cp.id}. ${cp.name}</div>
                    <div style=\"color:#666;margin-bottom:8px;\">${cp.knowledge.substring(0, 28)}...</div>
                    <button style=\"background:#FFD700;color:#8B0000;border:none;border-radius:16px;padding:6px 10px;font-weight:bold;cursor:pointer;\" onclick=\"showDetail(${cp.id})\">${statusText}</button>
                </div>
            `;
            marker.bindPopup(popupHtml);
            marker.addTo(markerLayer);
            bounds.push([cp.lat, cp.lng]);
        });
        if (bounds.length > 0) {
            mapInstance.fitBounds(bounds, { padding: [20, 20] });
        }

        // è§¦å‘åœ°å›¾å°ºå¯¸é‡ç®—ï¼ˆé¡µé¢åˆ‡æ¢åï¼‰
        setTimeout(() => { mapInstance.invalidateSize(); }, 50);
    }

    // åœ°ç†å®šä½åˆ°ç”¨æˆ·å½“å‰ä½ç½®
    function locateMe() {
        if (!mapInstance) return;
        if (!navigator.geolocation) {
            alert('å½“å‰è®¾å¤‡ä¸æ”¯æŒå®šä½');
            return;
        }
        navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const acc = pos.coords.accuracy || 50;
            if (!userLocationLayer) {
                userLocationLayer = L.layerGroup().addTo(mapInstance);
            }
            userLocationLayer.clearLayers();
            const me = L.marker([lat, lng], { title: 'æˆ‘çš„ä½ç½®' });
            const circle = L.circle([lat, lng], { radius: acc, color: '#2E8B57', fillColor: '#3CB371', fillOpacity: 0.2, weight: 1 });
            userLocationLayer.addLayer(circle);
            userLocationLayer.addLayer(me);
            mapInstance.fitBounds(L.latLngBounds([[lat, lng], [lat, lng]]).pad(0.02));
        }, err => {
            alert('å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™');
        }, { enableHighAccuracy: true, timeout: 8000 });
    }

    // æ˜¾ç¤ºæ‰“å¡è¯¦æƒ…
    function showDetail(id) {
        const cp = checkpoints.find(c => c.id === id);
        if (!cp) return;

        currentCheckpointId = id;

        document.getElementById('detail-title').textContent = cp.name;
        document.getElementById('detail-image').src = cp.image;
        document.getElementById('detail-knowledge').textContent = cp.knowledge;
        document.getElementById('detail-pose').textContent = cp.pose;
        document.getElementById('detail-badge-img').src = cp.badgeImg;
        document.getElementById('detail-badge-name').textContent = cp.badgeName;

        const checkInBtn = document.getElementById('check-in-btn');
        if (cp.completed) {
            checkInBtn.textContent = `âœ“ å·²å®Œæˆï¼ä½ å·²è·å¾— ${cp.badgeName} å¾½ç« `;
            checkInBtn.disabled = true;
        } else {
            checkInBtn.textContent = 'æˆ‘å·²åˆå½±ï¼Œå®Œæˆæ‰“å¡ï¼';
            checkInBtn.disabled = false;
        }

        showPage('detail-page');
    }

    // æ¨¡æ‹Ÿå®Œæˆæ‰“å¡
    function completeCheckpoint() {
        if (currentCheckpointId === null) return;

        const cp = checkpoints.find(c => c.id === currentCheckpointId);
        if (cp && !cp.completed) {
            cp.completed = true;
            const msg = `ğŸ‰ æ­å–œä½ ï¼æˆåŠŸå®Œæˆ ${cp.name} çš„æ‰“å¡ä»»åŠ¡ï¼Œè·å¾—äº† ${cp.badgeName} å¾½ç« ï¼ çº¿ç´¢ï¼š${getHint(cp.id)}`;
            showToast(msg);
            showPage('list-page'); // è¿”å›åˆ—è¡¨é¡µ
        }
    }

    // è·å–çº¿ç´¢æç¤º
    function getHint(id) {
        const hints = {
            1: "ç‰çºè—åœ¨ä¸­è½´çº¿ä¸Šï¼Œå®ƒå®ˆæŠ¤ç€æœ€é«˜çš„å®åº§ã€‚",
            2: "ç‰çºåœ¨çš‡å¸ä¼‘æ¯çš„åœ°æ–¹ï¼Œé‚£é‡Œæœ‰ç§˜å¯†çš„ç›’å­ã€‚",
            3: "ç‰çºåœ¨èŠ±å›­çš„ä¸­å¿ƒï¼Œè¢«æœ€å¤è€çš„æ ‘çœ‹ç€ã€‚",
            4: "ç‰çºåœ¨ä¹æ¡é¾™çš„æ—è¾¹ï¼Œå®ƒä»¬é¢æœåŒ—æ–¹ã€‚",
            5: "ç‰çºåœ¨æ•…å®«çš„è§’è½ï¼Œå®ƒèƒ½çœ‹åˆ°æ•´ä¸ªçš‡å®«ã€‚"
        };
        return hints[id] || "";
    }

    // é‡æ–°å¼€å§‹æ¸¸æˆ
    function resetGame() {
        checkpoints.forEach(cp => cp.completed = false);
        showPage('home-page');
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        // é¦–æ¬¡åŠ è½½æ—¶ï¼Œæ˜¾ç¤ºé¦–é¡µ
        showPage('home-page');
        // åˆ‡åˆ°åˆ—è¡¨é¡µæ—¶å†æ¸²æŸ“åœ°å›¾
    });

    // Toast æç¤º
    function showToast(message) {
        let toast = document.getElementById('global-toast');
        if (!toast) {
            toast = document.createElement('div');
            toast.id = 'global-toast';
            toast.className = 'toast';
            document.body.appendChild(toast);
        }
        toast.textContent = message;
        toast.style.display = 'block';
        clearTimeout(showToast._timer);
        showToast._timer = setTimeout(() => {
            toast.style.display = 'none';
        }, 2600);
    }
</script>

<body>
    <div class="container">
        <header>
            ğŸ¯ æ•…å®«å¯»å®ï¼šç¥å…½å¤§ä½œæˆ˜ ğŸ¯
        </header>
        <main>
            <!-- 1. é¦–é¡µ -->
            <section id="home-page" class="page active">
                <h2>å¯»æ‰¾å¤±è½çš„"ä¹é¾™ç‰çº"</h2>
                <div class="story-intro">
                    <p>âœ¨ <strong>å°çš‡å¸çš„ä¹é¾™ç‰çºè¢«æ·˜æ°”çš„ç¥å…½ä»¬è—èµ·æ¥å•¦ï¼</strong></p>
                    <p>å‹‡æ•¢çš„å°æœ‹å‹ï¼Œä½ éœ€è¦å»æ•…å®«çš„äº”ä¸ªé‡è¦åœ°æ–¹ï¼Œæ‰¾åˆ°å®ˆæŠ¤ç¥å…½ï¼Œå®Œæˆå®ƒä»¬æŒ‡å®šçš„ä»»åŠ¡ï¼ˆæ‰“å¡åˆç…§ï¼‰ï¼Œå°±èƒ½è·å¾—ä¸€æšç¥å…½å¾½ç« å’Œä¸€æ¡å…³äºç‰çºçš„çº¿ç´¢ã€‚</p>
                    <p>é›†é½æ‰€æœ‰å¾½ç« ï¼Œæ‹¼å‡ºè—å®å›¾ï¼Œæ‰¾åˆ°ç‰çºï¼Œä½ å°±æ˜¯<strong>æ•…å®«å°è‹±é›„ï¼</strong>ğŸ‰</p>
                </div>
                <button class="start-button" onclick="showPage('list-page')">å¼€å§‹å¯»å®ï¼</button>
            </section>

            <!-- 2. æ‰“å¡ç‚¹åˆ—è¡¨é¡µ -->
            <section id="list-page" class="page">
                <h2>ç¥å…½å¾½ç« æ”¶é›†è¿›åº¦</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%">
                        <span id="progress-text">0/5</span>
                    </div>
                </div>
                <div class="map-actions" style="display:flex; gap:10px; margin-bottom:12px; justify-content:flex-end;">
                    <button class="start-button" style="padding:10px 16px; font-size:1em; margin:0;" onclick="locateMe()">ğŸ“ å®šä½åˆ°æˆ‘</button>
                </div>
                <div id="map" style="width:100%; height: 420px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.15);"></div>
                <div id="reward-prompt" style="text-align: center; margin-top: 20px; display: none;">
                    <button class="start-button" onclick="showPage('reward-page')">é¢†å–ç»ˆæå¥–åŠ±ï¼</button>
                </div>
            </section>

            <!-- 3. æ‰“å¡è¯¦æƒ…é¡µ -->
            <section id="detail-page" class="page">
                <h2 id="detail-title"></h2>
                <img id="detail-image" class="detail-image" src="" alt="æ™¯ç‚¹å›¾ç‰‡">
                <div class="detail-knowledge" id="detail-knowledge"></div>

                <div class="pose-box">
                    <h4>ğŸ­ ç¥å…½ä»»åŠ¡ï¼šæ‰“å¡Poseè¦æ±‚</h4>
                    <p class="pose-text" id="detail-pose"></p>
                    <div class="badge-info">
                        <img id="detail-badge-img" src="" alt=" ç¥å…½å¾½ç« ">
                <p>å®Œæˆä»»åŠ¡ï¼Œå³å¯è·å¾— <strong id="detail-badge-name"></strong> å¾½ç« ï¼</p>
    </div>
    </div>

    <button class="action-button check-in-button" id="check-in-btn" onclick="completeCheckpoint()">æˆ‘å·²åˆå½±ï¼Œå®Œæˆæ‰“å¡ï¼</button>
    <button class="action-button back-button" onclick="showPage('list-page')">è¿”å›åˆ—è¡¨</button>
    </section>

    <!-- 4. ç»ˆæå¥–åŠ±é¡µ -->
    <section id="reward-page" class="page">
        <div class="trophy">ğŸ†</div>
        <h2>æ­å–œä½ ï¼Œæ•…å®«å°è‹±é›„ï¼</h2>
        <p style="font-size: 1.1em; margin-top: 15px;">ä½ é›†é½äº†æ‰€æœ‰ç¥å…½å¾½ç« ï¼ŒæˆåŠŸæ‹¼å‡ºäº†è—å®å›¾ï¼</p>

        <div class="certificate">
            <h2>ğŸ–ï¸ æ•…å®«å°è‹±é›„è¯ä¹¦ ğŸ–ï¸</h2>
            <p>ç‰¹æ­¤æˆäºˆ <strong>å‹‡æ•¢çš„å¯»å®è€…</strong></p>
            <p><strong>"æ•…å®«å°è‹±é›„"</strong>ç§°å·ï¼</p>
            <p style="margin-top: 15px; font-size: 1em;">ä½ æˆåŠŸå®Œæˆäº†æ•…å®«å®šå‘è¶Šé‡æŒ‘æˆ˜ï¼Œè·å¾—äº†æ‰€æœ‰ç¥å…½çš„è®¤å¯ï¼Œå¹¶æ‰¾å›äº†å¤±è½çš„ä¹é¾™ç‰çºï¼</p>
            <img id="seal-image" class="seal-image" src="ä¹é¾™ç‰çº.jpg" alt="ä¹é¾™ç‰çºå›¾ç‰‡">
            <p style="margin-top: 15px; color: #8B0000; font-weight: bold;">ğŸ ä½ å·²è·å¾—"æ•…å®«å°è‹±é›„"çš„è£èª‰ï¼</p>
        </div>
        <p style="margin-top: 20px; font-size: 1.05em;">å¸Œæœ›ä½ åœ¨æ•…å®«çš„å¯»å®ä¹‹æ—…ä¸­ï¼Œå­¦åˆ°äº†å¾ˆå¤šæœ‰è¶£çš„çŸ¥è¯†ï¼ä¸‹æ¬¡å†æ¥æ•…å®«æ—¶ï¼Œåˆ«å¿˜äº†è¿™äº›ç¥å…½æœ‹å‹å“¦ï¼ğŸ‘‹</p>
        <button class="start-button" style="margin-top: 20px;" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
    </section>
    </main>
    </div>

 <!-- Leaflet è„šæœ¬ -->
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</body>

</html>